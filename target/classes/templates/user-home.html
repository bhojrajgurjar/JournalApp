<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Your Journal</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">

<div class="max-w-5xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
  <!-- Header -->
  <div class="flex justify-between items-center border-b pb-4 mb-6">
    <h2 class="text-xl font-semibold text-gray-800">
      Welcome to Your Journal - <span th:text="${username}">Username</span>
    </h2>
    <button onclick="logout()" class="bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded">
      Logout
    </button>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-4 mb-6">
    <a th:href="@{/user/add-entry}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
      Add New Entry
    </a>
    <a th:href="@{/user/view-journal}" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
      View All Entries
    </a>
  </div>

  <!-- Latest Entry Table -->
  <div th:if="${latestEntry != null}">
    <h3 class="text-lg font-semibold text-gray-700 mb-3">Your Latest Journal Entry</h3>

    <table class="table-auto w-full border border-gray-300 rounded shadow text-sm">
      <thead class="bg-gray-200">
      <tr>
        <th class="px-4 py-2 border-b w-1/5 text-left">Title</th>
        <th class="px-4 py-2 border-b w-2/5 text-left">Content</th>
        <th class="px-4 py-2 border-b w-1/5 text-left">Date</th>
        <th class="px-4 py-2 border-b w-1/10 text-center">Edit</th>
        <th class="px-4 py-2 border-b w-1/10 text-center">Delete</th>
      </tr>
      </thead>
      <tbody>
      <tr class="hover:bg-gray-50">
        <td class="px-4 py-2 border-b" th:text="${latestEntry.tittle}">Title</td>
        <td class="px-4 py-2 border-b break-words max-w-4xl text-justify" th:text="${latestEntry.content}">Content</td>
        <td class="px-4 py-2 border-b" th:text="${#temporals.format(latestEntry.date, 'dd MMM yyyy HH:mm')}">Date</td>

        <!-- Edit Button -->
        <td class="px-4 py-2 border-b text-center">
          <button onclick="openEditModal('[[${latestEntry.id}]]', '[[${latestEntry.tittle}]]', '[[${latestEntry.content}]]')"
                  class="bg-blue-500 hover:bg-blue-700 text-white px-2 py-1 rounded text-sm">
            Edit
          </button>
        </td>

        <!-- Delete Button -->
        <td class="px-4 py-2 border-b text-center">
          <button onclick="deleteEntry('[[${latestEntry.id}]]')"
                  class="bg-red-500 hover:bg-red-700 text-white px-2 py-1 rounded text-sm">
            Delete
          </button>
        </td>
      </tr>
      </tbody>
    </table>

  </div>

  <!-- No Entries Message -->
  <div th:if="${latestEntry == null}" class="text-gray-700 mt-6">
    <p>You haven't added any journal entries yet.</p>
  </div>
</div>

<script>
  function logout() {
    document.cookie = "jwt=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; Secure; SameSite=Strict";
    window.location.href = "/welcome";
  }

  function deleteEntry(id) {
        if (confirm("Are you sure you want to delete this entry?")) {
            fetch(`/journal/id/${id}`, {
                method: "DELETE"
            }).then(response => {
                if (response.status === 204) {
                    alert("Deleted successfully!");
                    location.reload();
                } else {
                    alert("Failed to delete entry.");
                }
            });
        }
  }

</script>

</body>
</html>
