<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Your Journal Entries</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
<div class="max-w-6xl mx-auto mt-12">
    <div class="bg-white shadow-xl rounded-2xl p-8">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Your Journal Entries</h2>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">No.</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Content</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Update</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Delete</th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                <tr th:each="entry, stat : ${entries}">
                    <td class="px-6 py-4 whitespace-nowrap font-semibold text-gray-700" th:text="${stat.index + 1}"></td>
                    <td class="px-6 py-4 whitespace-nowrap" th:text="${entry.tittle}"></td>
                    <td class="px-6 py-4 whitespace-normal break-words max-w-4xl text-justify" th:text="${entry.content}"></td>
                    <td class="px-6 py-4 whitespace-nowrap" th:text="${#temporals.format(entry.date, 'dd MMM yyyy HH:mm')}"></td>
                    <td class="px-6 py-4">
                        <button onclick="openEditModal('[[${entry.id}]]', '[[${entry.tittle}]]', '[[${entry.content}]]')",
                                class="bg-blue-500 hover:bg-blue-700 text-white px-3 py-1 rounded">
                            Edit
                        </button>
                    </td>

                    <!-- Delete Button -->
                    <td class="px-6 py-4">
                        <form th:action="@{/user/journal/delete}" method="post" th:object="${entry}">
                            <input type="hidden" th:name="id" th:value="${entry.id}" />
                            <button type="submit" class="bg-red-500 hover:bg-red-700 text-white px-3 py-1 rounded">
                                Delete
                            </button>
                        </form>

                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50">
            <div class="bg-white p-6 rounded-xl w-[90%] md:w-[500px]">
                <h2 class="text-xl font-semibold mb-4">Edit Journal Entry</h2>
                <form id="editForm">
                    <input type="hidden" id="editId" />
                    <label class="block mb-2 font-medium">Title</label>
                    <input id="editTitle" type="text" class="w-full p-2 border rounded mb-4" />
                    <label class="block mb-2 font-medium">Content</label>
                    <textarea id="editContent" rows="5" class="w-full p-2 border rounded mb-4"></textarea>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeEditModal()" class="bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
                        <button type="submit" class="bg-green-600 hover:bg-green-800 text-white px-4 py-2 rounded">Save</button>
                    </div>
                </form>
            </div>
        </div>


        <div class="flex justify-center mt-6">
            <a th:href="@{/user/home}" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-xl transition duration-200">
                Back to Home
            </a>
        </div>
    </div>
</div>


<script>
  function deleteEntry(id) {
        if (confirm("Are you sure you want to delete this entry?")) {
        fetch(`/user/journal/id/${id}`, {
            method: "DELETE",
            credentials: "include"  // âœ… sends HttpOnly cookie with JWT
        }).then(response => {
            if (response.status === 204) {
                alert("Deleted successfully!");
                location.reload();
            } else {
                alert("Failed to delete entry.");
            }
        }).catch(err => {
            alert("Error deleting entry.");
            console.error(err);
        });
    }
  }

</script>
</body>

</html>
